# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation, including synchronization objects and image transitions. [RISK: me |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Audit resource bindings for compatibility with the recreated swapchain. [RISK: med]
- [ ] `shaders/ParameterUBO.glsl` — Confirm shader uniform buffer compatibility with the new swapchain. [RISK: low]
- [ ] `shaders/Engine.comp` — Verify compute shader behavior under swapchain recreation scenarios. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging for swapchain recreation steps. [RISK: low]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation, including synchronization objects and image transitions. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration, ensuring render pass and framebuffer updates are correct. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Audit resource bindings (e.g., images, buffers) for compatibility with the recreated swapchain, ensuring no stale references. [RISK: med]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Verify synchronization primitives (e.g., semaphores, fences) are correctly reset or recreated during swapchain recreation. [RISK: med]
- [ ] `shaders/ParameterUBO.glsl` — Confirm shader uniform buffer compatibility with the new swapchain, ensuring no layout mismatches. [RISK: low]
- [ ] `shaders/Engine.comp` — Verify compute shader behavior under swapchain recreation scenarios, particularly resource bindings and memory barriers. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity, breaking down into smaller helper functions. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging for swapchain recreation steps, including Vulkan API call results and resource states. [RISK: low]

## C++ Lead
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Audit resource bindings for compatibility with the recreated swapchain. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Confirm shader uniform buffer compatibility with the new swapchain. [RISK: low]
- [ ] `shaders/Engine.comp` — Verify compute shader behavior under swapchain recreation scenarios. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging for swapchain recreation steps. [RISK: low]

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  try {
    Log::text("Recreating swapchain...");
    mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                 mechanics.queues,
                                 mechanics.sync_objects,
                                 *pipelines,
                                 *resources);
    Log::text("Swapchain recreation completed successfully.");
  } catch (const std::exception &e) {
    Log::text("Error during swapchain recreation: ", e.what());
    throw; // Re-throw to ensure proper error handling upstream.
  }
}
```

## Next Run
- **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling during swapchain recreation.

## Vulkan Guru
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation, including synchronization objects and image transitions. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration, ensuring render pass and framebuffer updates are correct. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Audit resource bindings (e.g., images, buffers) for compatibility with the recreated swapchain, ensuring no stale references. [RISK: med]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Verify synchronization primitives (e.g., semaphores, fences) are correctly reset or recreated during swapchain recreation. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Confirm shader uniform buffer compatibility with the new swapchain, ensuring no layout mismatches. [RISK: low]
- [ ] `shaders/Engine.comp` — Verify compute shader behavior under swapchain recreation scenarios, particularly resource bindings and memory barriers. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity, breaking down into smaller helper functions. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging for swapchain recreation steps, including Vulkan API call results and resource states. [RISK: low]

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  try {
    Log::text("Recreating swapchain...");

    // Ensure all GPU operations are complete before destroying resources
    mechanics.sync_objects.wait_for_idle();

    // Destroy old swapchain resources
    mechanics.swapchain.cleanup();

    // Recreate the swapchain with updated surface and configuration
    mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                 mechanics.queues,
                                 mechanics.sync_objects,
                                 *pipelines,
                                 *resources);

    // Reinitialize dependent resources
    pipelines->rebuild_for_swapchain(mechanics.swapchain);
    resources->update_bindings_for_swapchain(mechanics.swapchain);

    Log::text("Swapchain recreation completed successfully.");
  } catch (const std::exception &e) {
    Log::text("Error during swapchain recreation: ", e.what());
    throw; // Re-throw to 

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling during swapchain recreation.
- **Vulkan Guru**: - **Next Agent**: Kernel Expert
- **Task Command**: Validate shader and compute pipeline compatibility with the new swapchain configuration.

## Guild Review

**Verdict**: CAUTION
**Summary**: The proposals generally align with the task goal of swapchain recreation but exhibit minor inconsistencies and potential scope violations. There are suspect API calls that may not exist in the Known APIs list, and the Vulkan Guru's proposal introduces changes to `src/vulkan_base/VulkanBaseSync.cpp`, which is out of scope. Additionally, there is a contradiction regarding the use of try/catch blocks in `recreate_swapchain()`.
**Hallucination Flags**: `mechanics.swapchain.recreate`, `mechanics.init_vulkan.surface`, `mechanics.queues`, `mechanics.sync_objects`, `*pipelines`, `*resources`

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 2/2 (100%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 0/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 4784ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 1/1 (100%) |
| Vulkan Guru | 1/1 (100%) |
