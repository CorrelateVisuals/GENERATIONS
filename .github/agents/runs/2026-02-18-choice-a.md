# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med] |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain during recreation. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource bindings are updated after swapchain recreation. [RISK: med]
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain configuration. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure compute shaders are not affected by swapchain recreation. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add logging for swapchain recreation steps to improve debugging. [RISK: low]

## C++ Lead
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain during recreation. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource bindings are updated after swapchain recreation. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain configuration. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure compute shaders are not affected by swapchain recreation. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add logging for swapchain recreation steps to improve debugging. [RISK: low]

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  try {
    Log::text("Recreating swapchain...");
    mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                 mechanics.queues,
                                 mechanics.sync_objects,
                                 *pipelines,
                                 *resources);
    Log::text("Swapchain recreation completed successfully.");
  } catch (const std::exception &e) {
    Log::text("Error during swapchain recreation: ", e.what());
    throw; // Re-throw to ensure proper error handling upstream
  }
}
```

## Next Run
- **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling and pipeline compatibility during swapchain recreation. Ensure no resource leaks or invalid states occur.

## Vulkan Guru
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain during recreation. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource bindings are updated after swapchain recreation. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain configuration. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure compute shaders are not affected by swapchain recreation. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to improve readability and modularity. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add logging for swapchain recreation steps to improve debugging. [RISK: low]

---

## Code Proposal

```cpp
// src/vulkan_mechanics/Mechanics.cpp

void Swapchain::recreate(VkSurfaceKHR surface,
                         const Queues &queues,
                         const SyncObjects &sync_objects,
                         Pipelines &pipelines,
                         VulkanResources &resources) {
  // Ensure proper cleanup of old swapchain resources
  vkDeviceWaitIdle(device);

  // Destroy old swapchain images and framebuffers
  for (auto framebuffer : framebuffers) {
    vkDestroyFramebuffer(device, framebuffer, nullptr);
  }
  framebuffers.clear();

  for (auto imageView : imageViews) {
    vkDestroyImageView(device, imageView, nullptr);
  }
  imageViews.clear();

  vkDestroySwapchainKHR(device, swapchain, nullptr);

  // Recreate swapchain
  create_swapchain(surface);
  create_image_views();
  create_framebuffers();

  // Update dependent resources
  pipelines.update_for_new_swapchain();
  resources.update_bindings_for_swapchain();
}
```

---

## Next Run
- **Next Agent**: Kernel Expert
- **Task Command**: Validate shader compatibility and ensure compute shaders are unaffected by swapchain recreation.

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling and pipeline compatibility during swapchain recreation. Ensure no resource leaks or invalid states occur.
- **Vulkan Guru**: - **Next Agent**: Kernel Expert
- **Task Command**: Validate shader compatibility and ensure compute shaders are unaffected by swapchain recreation.

## Guild Review

**Verdict**: CAUTION
**Summary**: The proposals generally align with the task goal of swapchain recreation but contain potential issues with hallucinated APIs and minor contradictions. While the Vulkan Guru's and Kernel Expert's TODOs focus on Vulkan-specific resource handling and shader compatibility, the Refactorer's suggestion to improve modularity and logging is valid but lacks clarity on implementation specifics. The proposals should be reviewed further for coherence and accuracy.
**Hallucination Flags**: `mechanics.swapchain.recreate`, `vkDeviceWaitIdle`, `vkDestroyFramebuffer`

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 2/2 (100%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 0/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 4097ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 1/1 (100%) |
| Vulkan Guru | 1/1 (100%) |
