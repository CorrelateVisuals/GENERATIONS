# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Review `Swapchain::recreate` method to ensure proper cleanup and reinitialization of Vulkan resources. [RISK: med] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure the `swapchain.recreate` method properly handles resource cleanup and reinitialization of dependent Vulkan objects (e.g., pipelines, frame contexts, |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Review `Swapchain::recreate` method to ensure proper cleanup and reinitialization of Vulkan resources. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Verify that resources dependent on the swapchain are properly reinitialized after recreation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Ensure that pipelines are correctly re-created after swapchain recreation. [RISK: med]
- [ ] `shaders/Engine.comp` — Verify that shaders are compatible with the new swapchain configuration. [RISK: low]
- [ ] `shaders/PostFX.comp` — Verify that shaders are compatible with the new swapchain configuration. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Review the naming and structure of the `recreate_swapchain` function for clarity and consistency with project conventions. [RISK: low]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure the `swapchain.recreate` method properly handles resource cleanup and reinitialization of dependent Vulkan objects (e.g., pipelines, frame contexts, and resources) to avoid resource leaks or undefined behavior. [RISK: medium]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Add error handling for swapchain recreation failures to ensure the application can gracefully recover or terminate. [RISK: high]
- [ ] `src/vulkan_pipelines/FrameContext.cpp` — Verify that per-frame resources are properly reinitialized after swapchain recreation. [RISK: medium]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Ensure pipeline objects are re-created or updated to match the new swapchain configuration. [RISK: medium]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm that image and buffer resources are properly destroyed and recreated during swapchain recreation. [RISK: medium]

## C++ Lead
---

## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Review `Swapchain::recreate` method to ensure proper cleanup and reinitialization of Vulkan resources. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Verify that resources dependent on the swapchain are properly reinitialized after recreation. [RISK: med]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Ensure that pipelines are correctly re-created after swapchain recreation. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/Engine.comp` — Verify that shaders are compatible with the new swapchain configuration. [RISK: low]
- [ ] `shaders/PostFX.comp` — Verify that shaders are compatible with the new swapchain configuration. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Review the naming and structure of the `recreate_swapchain` function for clarity and consistency with project conventions. [RISK: low]

---

## Code Proposal

```cpp
void CapitalEngine::recreate_swapchain() {
    // Log the start of the swapchain recreation process
    Log::text(Log::St

... [output truncated by factory gate] ...

## Vulkan Guru
## TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure the `swapchain.recreate` method properly handles resource cleanup and reinitialization of dependent Vulkan objects (e.g., pipelines, frame contexts, and resources) to avoid resource leaks or undefined behavior. [RISK: medium]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Add error handling for swapchain recreation failures to ensure the application can gracefully recover or terminate. [RISK: high]
- [ ] `src/vulkan_pipelines/FrameContext.cpp` — Verify that per-frame resources are properly reinitialized after swapchain recreation. [RISK: medium]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Ensure pipeline objects are re-created or updated to match the new swapchain configuration. [RISK: medium]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm that image and buffer resources are properly destroyed and recreated during swapchain recreation. [RISK: medium]

## Code Proposal
```cpp
void CapitalEngine::recreate_swapchain() {
    // Log the start of the swapchain recreation process
    Log::text(Log::Style::header_guard);
    Log::text("| Recreating Swapchain");

    // Cleanup resources dependent on the swapchain
    frame_context->cleanup();
    pipelines->cleanup();
    resources->cleanup();

    // Recreate the swapchain
    try {
        mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                     mechanics.queues,
                                     mechanics.sync_objects,
                                     *pipelines,
                                     *resources);
    } catch (const std::exception& e) {
        Log::text(Log::Style::header_guard);
        Log::text("| Swapchain recreation failed: ", e.what());
        throw; // Re-throw the exception to allow higher-level handling
    }

    // Reinitialize resources dependent on the new swapchain
    resources->initialize(mechanics.swapchain);
    pipelines->initialize(mechanics.swapchain, *resources);
    frame_context->initialize(mechanics.swapchain, *resources, *pipelines);

    // Log the successful completion of the swapchain recreation process
    Log::text("| Swapchain recreation completed successfully");
    Log::text(Log::Style::header_guard);
}
```

## Cross-Confirmation
1. ✅ **CONCUR** — The C++ Lead's observation about the lack of resource cleanup and reinitialization during swapchain recreation is accurate. Without proper cleanup, resource leaks or undefined behavior could occur.
2.

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: CHARGE-SWAPCHAIN-RECREATION

The Vulkan Guru should:
1. Review the `Swapchain::recreate` method to ensure proper cleanup and reinitialization of Vulkan resources.
2. Verify that the proposed changes in `recreate_swapchain` align with Vulkan best practices.
3. Confirm that the Vulkan resource semantics are correctly handled during swapchain recreation.
- **Vulkan Guru**: - **Next Agent**: Kernel Expert
- **Task Command**: CHARGE-SWAPCHAIN-RECREATION
- **Reason**: The Kernel Expert should validate the proposed changes to ensure that the swapchain recreation process does not negatively impact GPU performance, particularly in terms of synchronization, pipeline barriers, and resource usage.

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 1/2 (50%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 1/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 6024ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 0/1 (0%) |
| Vulkan Guru | 1/1 (100%) |
