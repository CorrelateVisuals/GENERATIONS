# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization [RISK: high]. |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization, including image layout transitions and pipeline barrier |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization [RISK: high].
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration [RISK: med].
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and descriptor updates during swapchain recreation [RISK: med].
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain image format and extent [RISK: med].
- [ ] `shaders/Engine.comp` — Ensure compute shaders handle the updated swapchain dimensions correctly [RISK: med].
- [ ] `shaders/PostFX.comp` — Confirm post-processing shaders adapt to the new swapchain configuration [RISK: med].
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain()` for clarity and modularity; consider extracting Vulkan-specific logic into `VulkanMechanics` [RISK: low].
- [ ] `src/engine/Log.cpp` — Add detailed logging around `recreate_swapchain()` to trace failures and resource states [RISK: low].
- [ ] GUILD:Architecture — Audit `recreate_swapchain()` for boundary violations between `engine/` and `vulkan_mechanics/` [RISK: low].
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization, including image layout transitions and pipeline barriers. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration, ensuring render pass and framebuffer updates are correct. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and descriptor updates during swapchain recreation, including image views and framebuffers. [RISK: med]
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain image format and extent, ensuring no mismatches in UBO layouts. [RISK: med]
- [ ] `shaders/Engine.comp` — Ensure compute shaders handle the updated swapchain dimensions correctly, particularly for workgroup size and dispatch parameters. [RISK: med]
- [ ] `shaders/PostFX.comp` — Confirm post-processing shaders adapt to the new swapchain configuration, including any changes to image sampling or output formats. [RISK: med]
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain()` for clarity and modularity; consider extracting Vulkan-specific logic into `VulkanMechanics`. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging around `recreate_swapchain()` to trace failures and resource states, including Vulkan validation layer messages. [RISK: low]
- [ ] GUILD:Architecture — Audit `recreate_swapchain()` for boundary violations between `engine/` and `vulkan_mechanics/`. [RISK: low]

## C++ Lead
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization [RISK: high].
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration [RISK: med].
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and descriptor updates during swapchain recreation [RISK: med].

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain image format and extent [RISK: med].
- [ ] `shaders/Engine.comp` — Ensure compute shaders handle the updated swapchain dimensions correctly [RISK: med].
- [ ] `shaders/PostFX.comp` — Confirm post-processing shaders adapt to the new swapchain configuration [RISK: med].

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain()` for clarity and modularity; consider extracting Vulkan-specific logic into `VulkanMechanics` [RISK: low].
- [ ] `src/engine/Log.cpp` — Add detailed logging around `recreate_swapchain()` to trace failures and resource states [RISK: low].
- [ ] GUILD:Architecture — Audit `recreate_swapchain()` for boundary violations between `engine/` and `vulkan_mechanics/` [RISK: low].

---

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  try {
    Log::text("Recreating swapchain...");
    mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                 mechanics.queues,
                                 mechanics.sync_objects,
                                 *pipelines,
                                 *resources);
    Log::text("Swapchain recreation successful.");
  } catch (const std::exception &e) {
    Log::text("Error during swapchain recreation: ", e.what());
    throw; // Re-throw to ensure proper error handling upstream
  }
}
```

---

## Next Run

- **Next Agent**: Vulkan Guru
- **Task Command**: Validate and refine `swapchain.recreate()` implementation, ensuring proper resource transitions, synchronization, and compatibility with pipelines and shaders.

## Vulkan Guru
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles all Vulkan resource transitions and synchronization, including image layout transitions and pipeline barriers. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Validate pipeline compatibility with the new swapchain configuration, ensuring render pass and framebuffer updates are correct. [RISK: med]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and descriptor updates during swapchain recreation, including image views and framebuffers. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify shader compatibility with the new swapchain image format and extent, ensuring no mismatches in UBO layouts. [RISK: med]
- [ ] `shaders/Engine.comp` — Ensure compute shaders handle the updated swapchain dimensions correctly, particularly for workgroup size and dispatch parameters. [RISK: med]
- [ ] `shaders/PostFX.comp` — Confirm post-processing shaders adapt to the new swapchain configuration, including any changes to image sampling or output formats. [RISK: med]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain()` for clarity and modularity; consider extracting Vulkan-specific logic into `VulkanMechanics`. [RISK: low]
- [ ] `src/engine/Log.cpp` — Add detailed logging around `recreate_swapchain()` to trace failures and resource states, including Vulkan validation layer messages. [RISK: low]
- [ ] GUILD:Architecture — Audit `recreate_swapchain()` for boundary violations between `engine/` and `vulkan_mechanics/`. [RISK: low]

---

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  try {
    Log::text("Recreating swapchain...");
    
    // Ensure all GPU operations are completed before destroying resources
    mechanics.sync_objects.wait_for_idle();

    // Recreate the swapchain and associated resources
    mechanics.swapchain.recreate(
        mechanics.init_vulkan.surface,
        mechanics.queues,
        mechanics.sync_objects,
        *pipelines,
        *resources
    );

    // Update frame context with the new swapchain configuration
    frame_context->update_swapchain(mechanics.swapchain);

    Log::text("Swapchain recreation completed successfully.");
  } catch (const std::exception &e) {
    Log::text("Error during swapchain recreation: ", e.what());
    throw; // Re-throw to ensure pr

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate and refine `swapchain.recreate()` implementation, ensuring proper resource transitions, synchronization, and compatibility with pipelines and shaders.
- **Vulkan Guru**: - **Next Agent**: Kernel Expert
- **Task Command**: Validate shader compatibility with the new swapchain configuration, focusing on `shaders/ParameterUBO.glsl`, `shaders/Engine.comp`, and `shaders/PostFX.comp`.

## Guild Review

**Verdict**: CAUTION
**Summary**: The proposals generally align with the task goal of swapchain recreation but exhibit minor inconsistencies and potential scope violations. There are no hallucinated APIs, but the Vulkan Guru's proposal mentions pipeline barriers and image layout transitions without explicitly tying them to known APIs, which could lead to ambiguity. Additionally, the Refactorer suggests modularizing Vulkan-specific logic, which may require changes outside the defined scope.

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 2/2 (100%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 0/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 5072ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 1/1 (100%) |
| Vulkan Guru | 1/1 (100%) |
