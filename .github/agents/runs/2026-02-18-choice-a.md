# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation. [RISK: med] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation. [RISK: med] |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (fences, semaphores) are reset or recreated as needed during swapchain recreation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the new swapchain images are correctly integrated with the existing pipeline and descriptor sets. [RISK: high]
- [ ] `shaders/ParameterUBO.glsl` — Verify that any changes to swapchain dimensions or formats are compatible with shader expectations. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure that the compute shader logic does not assume fixed swapchain dimensions. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Extract `recreate_swapchain` logic into a helper function to improve readability and reduce duplication. [RISK: low]
- [ ] `src/engine/CapitalEngine.h` — Add comments to clarify the lifecycle of `recreate_swapchain` and its interaction with other engine components. [RISK: low]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Verify that the swapchain recreation process respects Vulkan synchronization rules, including proper pipeline barriers and image layout transitions. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseResources.cpp` — Audit resource allocation during swapchain recreation to ensure no memory leaks or dangling handles. [RISK: med]

## C++ Lead
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (fences, semaphores) are reset or recreated as needed during swapchain recreation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the new swapchain images are correctly integrated with the existing pipeline and descriptor sets. [RISK: high]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify that any changes to swapchain dimensions or formats are compatible with shader expectations. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure that the compute shader logic does not assume fixed swapchain dimensions. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Extract `recreate_swapchain` logic into a helper function to improve readability and reduce duplication. [RISK: low]
- [ ] `src/engine/CapitalEngine.h` — Add comments to clarify the lifecycle of `recreate_swapchain` and its interaction with other engine components. [RISK: low]

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  // Log the start of the swapchain recreation process
  Log::text(Log::Style::header_guard);
  Log::text("| Recreating Swapchain");

  // Ensure Vulkan resources are properly cleaned up before recreating the swapchain
  mechanics.swapchain.recreate(
      mechanics.init_vulkan.surface,
      mechanics.queues,
      mechanics.sync_objects,
      *pipelines,
      *resources);

  // Log the completion of the swapchain recreation process
  Log::text("| Swapchain Recreation Complete");
  Log::text(Log::Style::header_guard);
}
```

<reasoning>
The proposed change ensures that the `recreate_swapchain` function logs the start and end of the swapchain recreation process, improving traceability during debugging. The function itself remains minimal and delegates the actual Vulkan resource handling to the `mechanics.swapchain.recreate` method, adhering to the principle of clear ownership.

The Vulkan Guru will need to confirm that the `recreate` method in `Mechanics.cpp` properly handles Vulkan resource cleanup and reallocation. Additionally, synchronization objects and pipeline integration must be validated to ensure correctness.

The Kernel Expert will need to verify that shaders are compatible with any changes to swapchain dimension

... [output truncated by factory gate] ...

## Vulkan Guru
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (fences, semaphores) are reset or recreated as needed during swapchain recreation. [RISK: med]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the new swapchain images are correctly integrated with the existing pipeline and descriptor sets. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Verify that the swapchain recreation process respects Vulkan synchronization rules, including proper pipeline barriers and image layout transitions. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseResources.cpp` — Audit resource allocation during swapchain recreation to ensure no memory leaks or dangling handles. [RISK: med]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify that any changes to swapchain dimensions or formats are compatible with shader expectations. [RISK: low]
- [ ] `shaders/Engine.comp` — Ensure that the compute shader logic does not assume fixed swapchain dimensions. [RISK: low]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Extract `recreate_swapchain` logic into a helper function to improve readability and reduce duplication. [RISK: low]
- [ ] `src/engine/CapitalEngine.h` — Add comments to clarify the lifecycle of `recreate_swapchain` and its interaction with other engine components. [RISK: low]

## Code Proposal

```cpp
// src/vulkan_mechanics/Mechanics.cpp

void VulkanMechanics::recreate_swapchain(VkSurfaceKHR surface, const Queues& queues, const SyncObjects& sync_objects, Pipelines& pipelines, VulkanResources& resources) {
    // Ensure all GPU operations are complete before destroying resources
    vkDeviceWaitIdle(device);

    // Destroy old swapchain images and associated resources
    swapchain.cleanup();

    // Recreate the swapchain
    swapchain.create(surface, queues, sync_objects);

    // Reintegrate new swapchain images with pipelines and descriptor sets
    pipelines.update_for_swapchain(swapchain);
    resources.update_for_swapchain(swapchain);

    // Log the completion of the swapchain recreation process
    Log::text(Log::Style::header_guard);
    Log::text("| Swapchain recreation complete");
}
```

## Cross-Confirmation

### C++ Lead Findings
1. **Ensure `swapchain.recreate` properly handles Vulkan resource cleanup and reallocation.

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling and synchronization during swapchain recreation.
- **Vulkan Guru**: - **Next Agent:** Kernel Expert
- **Task Command:** CHARGE-SWAPCHAIN-RECREATION

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 1/2 (50%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 1/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 6314ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 0/1 (0%) |
| Vulkan Guru | 1/1 (100%) |
