# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: high] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: high] |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (semaphores, fences) are reset or recreated during swapchain recreation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the swapchain image views are correctly updated after recreation. [RISK: medium]
- [ ] `shaders/ParameterUBO.glsl` — Verify that any shader parameters dependent on swapchain dimensions are updated correctly. [RISK: medium]
- [ ] `shaders/Engine.comp` — Ensure that any compute shaders relying on swapchain dimensions or image formats are adjusted post-recreation. [RISK: medium]
- [ ] `src/engine/CapitalEngine.cpp` — Add logging around `recreate_swapchain()` to improve traceability of swapchain recreation events. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to ensure it adheres to single-responsibility principles (e.g., delegate resource cleanup to a helper function). [RISK: low]
- [ ] `src/vulkan_base/VulkanBaseResources.cpp` — Verify that Vulkan memory allocations (buffers, images) tied to the old swapchain are properly released before recreating the swapchain. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Ensure that the synchronization primitives (e.g., fences, semaphores) are compatible with the new swapchain images. [RISK: medium]
- [ ] `src/vulkan_base/VulkanBasePipeline.cpp` — Confirm that pipelines referencing the old swapchain are revalidated or recreated as needed. [RISK: medium]

## C++ Lead
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (semaphores, fences) are reset or recreated during swapchain recreation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the swapchain image views are correctly updated after recreation. [RISK: medium]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify that any shader parameters dependent on swapchain dimensions are updated correctly. [RISK: medium]
- [ ] `shaders/Engine.comp` — Ensure that any compute shaders relying on swapchain dimensions or image formats are adjusted post-recreation. [RISK: medium]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Add logging around `recreate_swapchain()` to improve traceability of swapchain recreation events. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to ensure it adheres to single-responsibility principles (e.g., delegate resource cleanup to a helper function). [RISK: low]

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
    Log::text(Log::Style::header_guard);
    Log::text("[SWAPCHAIN] Starting swapchain recreation...");

    try {
        mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                     mechanics.queues,
                                     mechanics.sync_objects,
                                     *pipelines,
                                     *resources);

        Log::text("[SWAPCHAIN] Swapchain recreation completed successfully.");
    } catch (const std::exception &e) {
        Log::text("[SWAPCHAIN] Error during swapchain recreation: " + std::string(e.what()));
        throw; // Re-throw to ensure proper error handling upstream.
    }
}
```

## Next Run

- **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling during swapchain recreation.

## Vulkan Guru
## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate()` properly handles Vulkan resource cleanup and reallocation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Validate synchronization objects (semaphores, fences) are reset or recreated during swapchain recreation. [RISK: high]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Confirm that the swapchain image views are correctly updated after recreation. [RISK: medium]
- [ ] `src/vulkan_base/VulkanBaseResources.cpp` — Verify that Vulkan memory allocations (buffers, images) tied to the old swapchain are properly released before recreating the swapchain. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Ensure that the synchronization primitives (e.g., fences, semaphores) are compatible with the new swapchain images. [RISK: medium]
- [ ] `src/vulkan_base/VulkanBasePipeline.cpp` — Confirm that pipelines referencing the old swapchain are revalidated or recreated as needed. [RISK: medium]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Verify that any shader parameters dependent on swapchain dimensions are updated correctly. [RISK: medium]
- [ ] `shaders/Engine.comp` — Ensure that any compute shaders relying on swapchain dimensions or image formats are adjusted post-recreation. [RISK: medium]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Add logging around `recreate_swapchain()` to improve traceability of swapchain recreation events. [RISK: low]
- [ ] `src/engine/CapitalEngine.cpp` — Refactor `recreate_swapchain()` to ensure it adheres to single-responsibility principles (e.g., delegate resource cleanup to a helper function). [RISK: low]

---

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
    Log::text(Log::Style::header_guard);
    Log::text("[SWAPCHAIN] Starting swapchain recreation...");

    try {
        // Ensure proper cleanup of Vulkan resources tied to the old swapchain
        mechanics.swapchain.cleanup();

        // Recreate the swapchain with updated parameters
        mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                                     mechanics.queues,
                                     mechanics.sync_objects,
                                     *pipelines,
                                     *resources);

        // Update image views and synchronization objects
        resources->update_image_views(mechanics.swapch

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource handling during swapchain recreation.
- **Vulkan Guru**: - **Next Agent**: Kernel Expert
- **Task Command**: CHARGE-SWAPCHAIN-RECREATION

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 2/2 (100%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 0/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 4986ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 1/1 (100%) |
| Vulkan Guru | 1/1 (100%) |
