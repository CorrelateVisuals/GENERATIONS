# CHARGE-SWAPCHAIN-RECREATION — 2026-02-18

**Macro**: charge | **Agents**: C++ Lead → Vulkan Guru | **Status**: completed

## Agent Summary

| Agent | Finding |
|-------|---------|
| C++ Lead | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects. [RISK: high] |
| Vulkan Guru | - [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects, including destroying old framebuffers, images, and s |

## TODOs

- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Verify pipeline compatibility with the new swapchain and update if necessary. [RISK: high]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and synchronization after swapchain recreation. [RISK: high]
- [ ] `shaders/ParameterUBO.glsl` — Validate shader compatibility with the new swapchain configuration. [RISK: medium]
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain` for clarity and adherence to coding standards. [RISK: low]
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects, including destroying old framebuffers, images, and synchronization primitives. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Verify pipeline compatibility with the new swapchain, ensuring render pass and framebuffer dependencies are updated. [RISK: high]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm that all Vulkan resources (e.g., images, buffers) tied to the old swapchain are properly destroyed and recreated. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Validate synchronization objects (e.g., semaphores, fences) are correctly reset or recreated during swapchain recreation. [RISK: medium]
- [ ] GUILD:GPU-Pipeline — Review and validate barrier placement and synchronization correctness during swapchain recreation.

## C++ Lead
---

## TODOs

### Vulkan Guru TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Verify pipeline compatibility with the new swapchain and update if necessary. [RISK: high]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm resource reallocation and synchronization after swapchain recreation. [RISK: high]

### Kernel Expert TODOs
- [ ] `shaders/ParameterUBO.glsl` — Validate shader compatibility with the new swapchain configuration. [RISK: medium]

### Refactorer TODOs
- [ ] `src/engine/CapitalEngine.cpp` — Review `recreate_swapchain` for clarity and adherence to coding standards. [RISK: low]

---

## Code Proposal

```cpp
// src/engine/CapitalEngine.cpp

void CapitalEngine::recreate_swapchain() {
  // Log the start of the swapchain recreation process
  Log::text(Log::Style::header_guard);
  Log::text("| Recreating Swapchain");

  // Ensure all GPU operations are complete before proceeding
  mechanics.device.wait_idle();

  // Cleanup resources tied to the old swapchain
  pipelines->cleanup();
  frame_context->cleanup();
  resources->cleanup();

  // Recreate the swapchain
  mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                               mechanics.queues,
     

... [output truncated by factory gate] ...

## Vulkan Guru
## TODOs
- [ ] `src/vulkan_mechanics/Mechanics.cpp` — Ensure `swapchain.recreate` properly handles resource cleanup and reinitialization for Vulkan objects, including destroying old framebuffers, images, and synchronization primitives. [RISK: high]
- [ ] `src/vulkan_pipelines/Pipelines.cpp` — Verify pipeline compatibility with the new swapchain, ensuring render pass and framebuffer dependencies are updated. [RISK: high]
- [ ] `src/vulkan_resources/VulkanResources.cpp` — Confirm that all Vulkan resources (e.g., images, buffers) tied to the old swapchain are properly destroyed and recreated. [RISK: high]
- [ ] `src/vulkan_base/VulkanBaseSync.cpp` — Validate synchronization objects (e.g., semaphores, fences) are correctly reset or recreated during swapchain recreation. [RISK: medium]
- [ ] GUILD:GPU-Pipeline — Review and validate barrier placement and synchronization correctness during swapchain recreation.

## Code Proposal
```cpp
void CapitalEngine::recreate_swapchain() {
  // Ensure all GPU operations are completed before destroying resources
  vkDeviceWaitIdle(mechanics.device);

  // Destroy old swapchain-dependent resources
  resources->destroy_swapchain_dependent_resources();
  pipelines->destroy_swapchain_dependent_pipelines();

  // Recreate the swapchain
  mechanics.swapchain.recreate(mechanics.init_vulkan.surface,
                               mechanics.queues,
                               mechanics.sync_objects,
                               *pipelines,
                               *resources);

  // Reinitialize resources and pipelines for the new swapchain
  resources->initialize_swapchain_dependent_resources(mechanics.swapchain);
  pipelines->initialize_swapchain_dependent_pipelines(mechanics.swapchain);

  // Log the successful recreation
  Log::text("Swapchain successfully recreated.");
}
```

## Cross-Confirmation
- ✅ CONCUR — The C++ Lead's reasoning about the need for robust resource cleanup and reinitialization during swapchain recreation is correct. Vulkan objects tied to the old swapchain must be destroyed and recreated to avoid resource leaks and ensure compatibility with the new swapchain.
- ⚠️ QUALIFY — While the proposed changes are valid, additional attention must be given to synchronization objects (e.g., semaphores, fences) to ensure they are properly reset or recreated. This is critical to avoid race conditions or undefined behavior.
- ⚠️ QUALIFY — The `recreate_swapchain` function should include validation checks for the 

... [output truncated by factory gate] ...

## Next Run

- **C++ Lead**: - **Next Agent**: Vulkan Guru
- **Task Command**: Validate Vulkan resource cleanup and reinitialization during swapchain recreation. Confirm that the `recreate` method in `Mechanics.cpp` handles Vulkan-specific details correctly and adheres to best practices for resource management.
- **Vulkan Guru**: - **Next Agent:** Kernel Expert
- **Task Command:** Validate shader compatibility and workgroup configurations for the new swapchain. Ensure that any changes to the swapchain do not negatively impact shader execution or GPU occupancy.

## Factory Metrics (trailing 7 days)

| Metric | Value |
|--------|-------|
| Total agent calls | 2 |
| Pass rate | 1/2 (50%) |
| Retry rate | 0/2 |
| Halt rate | 0/2 |
| Warn rate | 1/2 |
| Cache hit rate | 0/2 (0%) |
| Avg latency | 6282ms |

### Agent Reliability

| Agent | Pass Rate |
|-------|----------|
| C++ Lead | 0/1 (0%) |
| Vulkan Guru | 1/1 (100%) |
